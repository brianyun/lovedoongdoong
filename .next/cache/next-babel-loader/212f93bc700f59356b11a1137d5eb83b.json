{"ast":null,"code":"var _jsxFileName = \"/Users/hsyun/code/web/full_project/firebase-MBTI/pages/loading.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { useDispatch } from \"react-redux\";\nimport { Typography, Row, Col } from \"antd\";\nimport { useSelector } from \"react-redux\";\nconst {\n  Text\n} = Typography;\nimport { ADD_URL } from \"../reducers/answer\";\nimport { MAKE_DIRECT_FALSE } from \"../reducers/answer\";\nimport db from \"../back/firestore\";\nimport storage from \"../back/cloudStorage\";\nimport { v4 as uuid } from \"uuid\";\nimport calculator from \"../back/calculator\";\nimport result from \"../assets/result.json\";\nimport { WidthDiv } from \"../assets/css/style_result\";\nimport { Spinner } from \"react-activity\";\n\nconst Loading = () => {\n  const router = useRouter();\n  const dispatch = useDispatch();\n  const {\n    ans\n  } = useSelector(state => state.answer);\n  const {\n    url\n  } = useSelector(state => state.answer);\n  const {\n    0: screenshotUrl,\n    1: setScreenshotUrl\n  } = useState(null);\n  const {\n    0: thumbUrl,\n    1: setThumbUrl\n  } = useState(null);\n  const {\n    0: goodUrl,\n    1: setGoodUrl\n  } = useState(null);\n  const {\n    0: badUrl,\n    1: setBadUrl\n  } = useState(null);\n  const {\n    0: ready,\n    1: setReady\n  } = useState(false);\n  const {\n    0: v,\n    1: setV\n  } = useState(null);\n  useEffect(() => {\n    if (ans) {\n      setV(result[calculator(ans)]);\n      const now = new Date();\n      const uid = uuid();\n      const userObj = {\n        answer: ans,\n        type: calculator(ans),\n        created_at: now,\n        updated_at: now\n      };\n      db.collection(\"results\").doc(uid).set(userObj).then(res => {}).catch(error => {//alert(\"error: \" + error.message);\n        //console.log(error);\n      });\n    } else {\n      router.push(\"/result/\".concat(calculator([])));\n    }\n  }, [ans]);\n  useEffect(() => {\n    if (v) {\n      storage.ref().child(v[\"screenshot\"]).getDownloadURL().then(url => {\n        setScreenshotUrl(url);\n      }).catch(err => {\n        return;\n      });\n      storage.ref().child(v[\"thumbnail\"]).getDownloadURL().then(url => {\n        setThumbUrl(url);\n      }).catch(err => {\n        return;\n      });\n      storage.ref().child(result[v[\"good\"]][\"thumbnail\"]).getDownloadURL().then(url => {\n        setGoodUrl(url);\n      }).catch(err => {\n        return;\n      });\n      storage.ref().child(result[v[\"bad\"]][\"thumbnail\"]).getDownloadURL().then(url => {\n        setBadUrl(url);\n      }).catch(err => {\n        return;\n      });\n    }\n  }, [v]);\n  useEffect(() => {\n    if (screenshotUrl && thumbUrl && goodUrl && badUrl) {\n      dispatch({\n        type: ADD_URL,\n        data: {\n          screenshotUrl: screenshotUrl,\n          thumbUrl: thumbUrl,\n          goodUrl: goodUrl,\n          badUrl: badUrl\n        }\n      });\n    }\n  }, [screenshotUrl, thumbUrl, goodUrl, badUrl]);\n  useEffect(() => {\n    dispatch({\n      type: MAKE_DIRECT_FALSE\n    });\n    setReady(true);\n  }, [url[\"badUrl\"]]); // function checkReady() {\n  // \tif (ready == false) {\n  // \t\twindow.setTimeout(checkReady, 1000);\n  // \t} else {\n  // \t\t//router.push(\"/result/\".concat(calculator(ans)));\n  // \t\t//setReady(false);\n  // \t}\n  // }\n  // checkReady();\n\n  useEffect(function checkReady() {\n    if (ready == false) {\n      window.setTimeout(checkReady, 1000);\n    } else {\n      router.push(\"/result/\".concat(calculator(ans)));\n      setReady(false);\n    }\n  }, []);\n  return __jsx(React.Fragment, null, __jsx(Row, {\n    justify: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 4\n    }\n  }, __jsx(Col, {\n    xs: 16,\n    sm: 14,\n    md: 10,\n    lg: 8,\n    xl: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 5\n    }\n  }, __jsx(WidthDiv, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 6\n    }\n  }, __jsx(Spinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }\n  })))), __jsx(Row, {\n    justify: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 4\n    }\n  }, __jsx(Col, {\n    xs: 16,\n    sm: 14,\n    md: 10,\n    lg: 8,\n    xl: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 5\n    }\n  }, __jsx(Text, {\n    style: {\n      textAlign: \"center\",\n      display: \"block\",\n      marginTop: \"30px\",\n      fontSize: \"20px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 6\n    }\n  }, \"\\uBD84\\uC11D\\uC911..\"))));\n};\n\nexport default Loading;","map":{"version":3,"sources":["/Users/hsyun/code/web/full_project/firebase-MBTI/pages/loading.js"],"names":["React","useEffect","useState","useRouter","useDispatch","Typography","Row","Col","useSelector","Text","ADD_URL","MAKE_DIRECT_FALSE","db","storage","v4","uuid","calculator","result","WidthDiv","Spinner","Loading","router","dispatch","ans","state","answer","url","screenshotUrl","setScreenshotUrl","thumbUrl","setThumbUrl","goodUrl","setGoodUrl","badUrl","setBadUrl","ready","setReady","v","setV","now","Date","uid","userObj","type","created_at","updated_at","collection","doc","set","then","res","catch","error","push","concat","ref","child","getDownloadURL","err","data","checkReady","window","setTimeout","textAlign","display","marginTop","fontSize"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { useDispatch } from \"react-redux\";\nimport { Typography, Row, Col } from \"antd\";\nimport { useSelector } from \"react-redux\";\nconst { Text } = Typography;\n\nimport { ADD_URL } from \"../reducers/answer\";\nimport { MAKE_DIRECT_FALSE } from \"../reducers/answer\";\n\nimport db from \"../back/firestore\";\nimport storage from \"../back/cloudStorage\";\nimport { v4 as uuid } from \"uuid\";\nimport calculator from \"../back/calculator\";\nimport result from \"../assets/result.json\";\n\nimport { WidthDiv } from \"../assets/css/style_result\";\nimport { Spinner } from \"react-activity\";\n\nconst Loading = () => {\n\tconst router = useRouter();\n\tconst dispatch = useDispatch();\n\tconst { ans } = useSelector((state) => state.answer);\n\tconst { url } = useSelector((state) => state.answer);\n\n\tconst [screenshotUrl, setScreenshotUrl] = useState(null);\n\tconst [thumbUrl, setThumbUrl] = useState(null);\n\tconst [goodUrl, setGoodUrl] = useState(null);\n\tconst [badUrl, setBadUrl] = useState(null);\n\tconst [ready, setReady] = useState(false);\n\n\tconst [v, setV] = useState(null);\n\n\tuseEffect(() => {\n\t\tif (ans) {\n\t\t\tsetV(result[calculator(ans)]);\n\n\t\t\tconst now = new Date();\n\t\t\tconst uid = uuid();\n\n\t\t\tconst userObj = {\n\t\t\t\tanswer: ans,\n\t\t\t\ttype: calculator(ans),\n\t\t\t\tcreated_at: now,\n\t\t\t\tupdated_at: now,\n\t\t\t};\n\n\t\t\tdb.collection(\"results\")\n\t\t\t\t.doc(uid)\n\t\t\t\t.set(userObj)\n\t\t\t\t.then((res) => {})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\t//alert(\"error: \" + error.message);\n\t\t\t\t\t//console.log(error);\n\t\t\t\t});\n\t\t} else {\n\t\t\trouter.push(\"/result/\".concat(calculator([])));\n\t\t}\n\t}, [ans]);\n\n\tuseEffect(() => {\n\t\tif (v) {\n\t\t\tstorage\n\t\t\t\t.ref()\n\t\t\t\t.child(v[\"screenshot\"])\n\t\t\t\t.getDownloadURL()\n\t\t\t\t.then((url) => {\n\t\t\t\t\tsetScreenshotUrl(url);\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\treturn;\n\t\t\t\t});\n\n\t\t\tstorage\n\t\t\t\t.ref()\n\t\t\t\t.child(v[\"thumbnail\"])\n\t\t\t\t.getDownloadURL()\n\t\t\t\t.then((url) => {\n\t\t\t\t\tsetThumbUrl(url);\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\treturn;\n\t\t\t\t});\n\n\t\t\tstorage\n\t\t\t\t.ref()\n\t\t\t\t.child(result[v[\"good\"]][\"thumbnail\"])\n\t\t\t\t.getDownloadURL()\n\t\t\t\t.then((url) => {\n\t\t\t\t\tsetGoodUrl(url);\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\treturn;\n\t\t\t\t});\n\n\t\t\tstorage\n\t\t\t\t.ref()\n\t\t\t\t.child(result[v[\"bad\"]][\"thumbnail\"])\n\t\t\t\t.getDownloadURL()\n\t\t\t\t.then((url) => {\n\t\t\t\t\tsetBadUrl(url);\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\treturn;\n\t\t\t\t});\n\t\t}\n\t}, [v]);\n\n\tuseEffect(() => {\n\t\tif (screenshotUrl && thumbUrl && goodUrl && badUrl) {\n\t\t\tdispatch({\n\t\t\t\ttype: ADD_URL,\n\t\t\t\tdata: {\n\t\t\t\t\tscreenshotUrl: screenshotUrl,\n\t\t\t\t\tthumbUrl: thumbUrl,\n\t\t\t\t\tgoodUrl: goodUrl,\n\t\t\t\t\tbadUrl: badUrl,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}, [screenshotUrl, thumbUrl, goodUrl, badUrl]);\n\n\tuseEffect(() => {\n\t\tdispatch({\n\t\t\ttype: MAKE_DIRECT_FALSE,\n\t\t});\n\t\tsetReady(true);\n\t}, [url[\"badUrl\"]]);\n\n\t// function checkReady() {\n\t// \tif (ready == false) {\n\t// \t\twindow.setTimeout(checkReady, 1000);\n\t// \t} else {\n\t// \t\t//router.push(\"/result/\".concat(calculator(ans)));\n\t// \t\t//setReady(false);\n\t// \t}\n\t// }\n\t// checkReady();\n\n\tuseEffect(function checkReady() {\n\t\tif (ready == false) {\n\t\t\twindow.setTimeout(checkReady, 1000);\n\t\t} else {\n\t\t\trouter.push(\"/result/\".concat(calculator(ans)));\n\t\t\tsetReady(false);\n\t\t}\n\t}, []);\n\n\treturn (\n\t\t<>\n\t\t\t<Row justify=\"center\">\n\t\t\t\t<Col xs={16} sm={14} md={10} lg={8} xl={8}>\n\t\t\t\t\t<WidthDiv>\n\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t</WidthDiv>\n\t\t\t\t</Col>\n\t\t\t</Row>\n\t\t\t<Row justify=\"center\">\n\t\t\t\t<Col xs={16} sm={14} md={10} lg={8} xl={8}>\n\t\t\t\t\t<Text\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\ttextAlign: \"center\",\n\t\t\t\t\t\t\tdisplay: \"block\",\n\t\t\t\t\t\t\tmarginTop: \"30px\",\n\t\t\t\t\t\t\tfontSize: \"20px\",\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t분석중..\n\t\t\t\t\t</Text>\n\t\t\t\t</Col>\n\t\t\t</Row>\n\t\t</>\n\t);\n};\n\nexport default Loading;\n"]},"metadata":{},"sourceType":"module"}