{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/hsyun/code/web/full_project/firebase-MBTI/pages/loading.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { useDispatch } from \"react-redux\";\nimport { Col } from \"antd\";\nimport { useSelector } from \"react-redux\";\nimport { ADD_URL } from \"../reducers/answer\";\nimport { MAKE_DIRECT_FALSE } from \"../reducers/answer\";\nimport db from \"../back/firestore\";\nimport storage from \"../back/cloudStorage\";\nimport { v4 as uuid } from \"uuid\";\nimport calculator from \"../back/calculator\";\nimport result from \"../assets/result.json\";\nimport { Container, containerCol, WidthImg, Texty, CaptionContainer } from \"../assets/css/style_loading\";\n\nvar Loading = function Loading() {\n  _s();\n\n  var router = useRouter();\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return state.answer;\n  }),\n      ans = _useSelector.ans;\n\n  var _useSelector2 = useSelector(function (state) {\n    return state.answer;\n  }),\n      url = _useSelector2.url;\n\n  var _useState = useState(null),\n      thumbUrl = _useState[0],\n      setThumbUrl = _useState[1];\n\n  var _useState2 = useState(false),\n      ready = _useState2[0],\n      setReady = _useState2[1];\n\n  var _useState3 = useState(null),\n      v = _useState3[0],\n      setV = _useState3[1];\n\n  useEffect(function () {\n    if (ans) {\n      console.log(\"ans is \", ans);\n      setV(result[calculator(ans)]);\n      var now = new Date();\n      var uid = uuid();\n      var userObj = {\n        answer: ans,\n        type: calculator(ans),\n        created_at: now,\n        updated_at: now\n      };\n      db.collection(\"results\").doc(uid).set(userObj).then(function (res) {})[\"catch\"](function (error) {\n        //alert(\"error: \" + error.message);\n        console.log(error);\n      });\n    } else {\n      console.log(\"no ans.. bye\");\n      router.push(\"/result/\".concat(calculator([])));\n    }\n  }, [ans]);\n  useEffect(function () {\n    if (v) {\n      storage.ref().child(v[\"thumbnail\"]).getDownloadURL().then(function (url) {\n        setThumbUrl(url);\n      })[\"catch\"](function (err) {\n        alert(err);\n      });\n    }\n  }, [v]);\n  useEffect(function () {\n    if (thumbUrl) {\n      dispatch({\n        type: ADD_URL,\n        data: {\n          thumbUrl: thumbUrl\n        }\n      });\n      setReady(true);\n    }\n  }, [thumbUrl]);\n  useEffect(function () {\n    dispatch({\n      type: MAKE_DIRECT_FALSE\n    });\n  }, [url[\"thumbUrl\"]]);\n\n  if (true) {\n    var checkReady = function checkReady() {\n      if (ready == false) {\n        window.setTimeout(checkReady, 500);\n      } else {\n        router.push(\"/result/\".concat(v[\"id\"]));\n        setReady(false);\n      }\n    };\n\n    checkReady();\n  }\n\n  return __jsx(React.Fragment, null, __jsx(Container, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 4\n    }\n  }, __jsx(Col, _extends({}, containerCol, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 5\n    }\n  }), __jsx(WidthImg, {\n    src: require(\"../assets/images/loading.gif\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 6\n    }\n  }), __jsx(CaptionContainer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 6\n    }\n  }, __jsx(Texty, {\n    top: 20,\n    font: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }\n  }, \"\\uBD84\\uC11D\\uC911..\")))));\n};\n\n_s(Loading, \"tUMMuR5jWNmrKZE5e6cs13o5brE=\", false, function () {\n  return [useRouter, useDispatch, useSelector, useSelector];\n});\n\n_c = Loading;\nexport default Loading;\n\nvar _c;\n\n$RefreshReg$(_c, \"Loading\");","map":{"version":3,"sources":["/Users/hsyun/code/web/full_project/firebase-MBTI/pages/loading.js"],"names":["React","useEffect","useState","useRouter","useDispatch","Col","useSelector","ADD_URL","MAKE_DIRECT_FALSE","db","storage","v4","uuid","calculator","result","Container","containerCol","WidthImg","Texty","CaptionContainer","Loading","router","dispatch","state","answer","ans","url","thumbUrl","setThumbUrl","ready","setReady","v","setV","console","log","now","Date","uid","userObj","type","created_at","updated_at","collection","doc","set","then","res","error","push","concat","ref","child","getDownloadURL","err","alert","data","checkReady","window","setTimeout","require"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { useDispatch } from \"react-redux\";\nimport { Col } from \"antd\";\nimport { useSelector } from \"react-redux\";\n\nimport { ADD_URL } from \"../reducers/answer\";\nimport { MAKE_DIRECT_FALSE } from \"../reducers/answer\";\n\nimport db from \"../back/firestore\";\nimport storage from \"../back/cloudStorage\";\nimport { v4 as uuid } from \"uuid\";\nimport calculator from \"../back/calculator\";\nimport result from \"../assets/result.json\";\n\nimport {\n\tContainer,\n\tcontainerCol,\n\tWidthImg,\n\tTexty,\n\tCaptionContainer,\n} from \"../assets/css/style_loading\";\n\nconst Loading = () => {\n\tconst router = useRouter();\n\tconst dispatch = useDispatch();\n\tconst { ans } = useSelector((state) => state.answer);\n\tconst { url } = useSelector((state) => state.answer);\n\n\tconst [thumbUrl, setThumbUrl] = useState(null);\n\tconst [ready, setReady] = useState(false);\n\n\tconst [v, setV] = useState(null);\n\n\tuseEffect(() => {\n\t\tif (ans) {\n\t\t\tconsole.log(\"ans is \", ans);\n\t\t\tsetV(result[calculator(ans)]);\n\n\t\t\tconst now = new Date();\n\t\t\tconst uid = uuid();\n\n\t\t\tconst userObj = {\n\t\t\t\tanswer: ans,\n\t\t\t\ttype: calculator(ans),\n\t\t\t\tcreated_at: now,\n\t\t\t\tupdated_at: now,\n\t\t\t};\n\n\t\t\tdb.collection(\"results\")\n\t\t\t\t.doc(uid)\n\t\t\t\t.set(userObj)\n\t\t\t\t.then((res) => {})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\t//alert(\"error: \" + error.message);\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t});\n\t\t} else {\n\t\t\tconsole.log(\"no ans.. bye\");\n\t\t\trouter.push(\"/result/\".concat(calculator([])));\n\t\t}\n\t}, [ans]);\n\n\tuseEffect(() => {\n\t\tif (v) {\n\t\t\tstorage\n\t\t\t\t.ref()\n\t\t\t\t.child(v[\"thumbnail\"])\n\t\t\t\t.getDownloadURL()\n\t\t\t\t.then((url) => {\n\t\t\t\t\tsetThumbUrl(url);\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\talert(err);\n\t\t\t\t});\n\t\t}\n\t}, [v]);\n\n\tuseEffect(() => {\n\t\tif (thumbUrl) {\n\t\t\tdispatch({\n\t\t\t\ttype: ADD_URL,\n\t\t\t\tdata: {\n\t\t\t\t\tthumbUrl: thumbUrl,\n\t\t\t\t},\n\t\t\t});\n\t\t\tsetReady(true);\n\t\t}\n\t}, [thumbUrl]);\n\n\tuseEffect(() => {\n\t\tdispatch({\n\t\t\ttype: MAKE_DIRECT_FALSE,\n\t\t});\n\t}, [url[\"thumbUrl\"]]);\n\n\tif (typeof window !== \"undefined\") {\n\t\tfunction checkReady() {\n\t\t\tif (ready == false) {\n\t\t\t\twindow.setTimeout(checkReady, 500);\n\t\t\t} else {\n\t\t\t\trouter.push(\"/result/\".concat(v[\"id\"]));\n\t\t\t\tsetReady(false);\n\t\t\t}\n\t\t}\n\t\tcheckReady();\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<Container>\n\t\t\t\t<Col {...containerCol}>\n\t\t\t\t\t<WidthImg src={require(\"../assets/images/loading.gif\")} />\n\t\t\t\t\t<CaptionContainer>\n\t\t\t\t\t\t<Texty top={20} font={20}>\n\t\t\t\t\t\t\t분석중..\n\t\t\t\t\t\t</Texty>\n\t\t\t\t\t</CaptionContainer>\n\t\t\t\t</Col>\n\t\t\t</Container>\n\t\t</>\n\t);\n};\n\nexport default Loading;\n"]},"metadata":{},"sourceType":"module"}